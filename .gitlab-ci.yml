stages:
  - install
  - wiki

variables:
  R_VERSION: "4.3.3"
  CI_GITLAB_TOKEN: $CI_GITLAB_TOKEN

pages:
  stage: wiki
  script:
  - mkdir .public
  - cp -r markdown/* .public
  - mv .public public
  artifacts:
    paths:
    - public
  only:
  - master

install_linux:
  stage: install
  image: rocker/r-ver:${R_VERSION}
  before_script:
  - apt-get update -qq && apt-get install -y --no-install-recommends
  - apt-get install -y git libcurl4-openssl-dev libssl-dev libxml2-dev libgmp3-dev libmpfr-dev cmake zlib1g-dev
  script:
    - R -e 'install.packages(c("remotes", "devtools"))'
    - R -e 'remotes::install_gitlab(repo = "umrf/ranomaly", host = "forgemia.inra.fr", auth_token = Sys.getenv("CI_GITLAB_TOKEN"))'
    - R -e 'devtools::check()'
